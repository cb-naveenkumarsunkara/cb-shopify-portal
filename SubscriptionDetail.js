var ue=Object.defineProperty,pe=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var J=(c,n,i)=>n in c?ue(c,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[n]=i,K=(c,n)=>{for(var i in n||(n={}))me.call(n,i)&&J(c,i,n[i]);if(G)for(var i of G(n))ye.call(n,i)&&J(c,i,n[i]);return c},Q=(c,n)=>pe(c,_e(n));import{d as E,f as o,g as u,h as a,t as s,y as I,w as d,k as C,l as e,K as B,z as M,s as $,G as U,u as X,x as Z,c as ve,b as ee,j as r,D as he,F as V,i as te,r as j,L as be,O as fe,a as ge,J as ke,v as P,Q as Pe,M as Y,o as $e,T as Ce,U as Se}from"./index.js";import{_ as F}from"./plugin-vue_export-helper.js";import{C as Ie}from"./CreateHeader.js";import{S as W}from"./Spinner.js";import{M as se,u as Me}from"./MethodCard.js";const Te={class:"c-portal-card"},we={class:"c-shopify-header c-display-flex c-justify-space-between"},L=E({props:{title:null,description:null,action:null},setup(c){return(n,i)=>(o(),u("section",Te,[a("div",we,[a("span",null,s(c.title),1),c.action?(o(),I(e(M),{key:0,class:"c-card-action",variant:e(B).Link,onClick:i[0]||(i[0]=l=>n.$emit(c.action.method))},{default:d(()=>[C(s(n.$t("portal.common.edit")),1)]),_:1},8,["variant"])):$("",!0)]),U(n.$slots,"default")]))}});const De={class:"c-breadcrumb-container"},Ne={key:0,class:"c-breadcrumb-separator"},qe=E({setup(c){const n=X(),i=Z(),l=ve(()=>{var p;return((p=n.meta)==null?void 0:p.breadcrumbs)||[]}),h=()=>{const p=l.value[l.value.length-1].routeName;i.push({name:p,query:{customer_id:n.query.customer_id}})};return(p,b)=>{const A=ee("router-link");return o(),u("section",De,[r(e(he),{class:"c-breadcrumb-back c-cursor-pointer",onClick:h}),(o(!0),u(V,null,te(e(l),(y,_)=>(o(),u("span",null,[_?(o(),u("span",Ne,"/")):$("",!0),r(A,{to:{name:y.routeName,query:{customer_id:p.$route.query.customer_id}},class:"c-breadcrumb-link"},{default:d(()=>[C(s(p.$t(y.label)),1)]),_:2},1032,["to"])]))),256))])}}});var Le=F(qe,[["__scopeId","data-v-29ce7164"]]);const Be={class:"c-select-pm-container"},Ee={class:"pm-edit-ctas"},Oe=E({props:{paymentMethods:null,currentPayment:null,loading:{type:Boolean}},setup(c){const i=j(c.currentPayment),l=h=>{i.value=h};return(h,p)=>(o(),u(V,null,[a("div",Be,[(o(!0),u(V,null,te(c.paymentMethods,b=>(o(),I(se,{key:b.id,pm:b,"is-editable":!1,"is-selectable":!0,"is-selected":i.value.id===b.id,disabled:c.loading,onSelectPayment:l},null,8,["pm","is-selected","disabled"]))),128))]),a("div",Ee,[r(e(M),{variant:e(B).Primary,class:"pm-update-primary-cta",loading:c.loading,onClick:p[0]||(p[0]=b=>h.$emit("updatePayment",i.value))},{default:d(()=>[C(s(h.$t("portal.subscription_details.update_payment_method")),1)]),_:1},8,["variant","loading"]),r(e(M),{variant:e(B).Link,disabled:c.loading,onClick:p[1]||(p[1]=b=>h.$emit("cancelUpdatePayment"))},{default:d(()=>[C(s(h.$t("portal.common.cancel")),1)]),_:1},8,["variant","disabled"])])],64))}});var Ue=F(Oe,[["__scopeId","data-v-273e7e82"]]);const Ve=E({setup(c){const n=j(!1);return(i,l)=>(o(),u(V,null,[r(e(fe),be({isOpen:n.value,onClose:()=>n.value=!1},i.$attrs),{content:d(()=>[U(i.$slots,"content")]),footer:d(()=>[U(i.$slots,"footer",{close:()=>n.value=!1})]),_:3},16,["isOpen","onClose"]),U(i.$slots,"default",{open:()=>n.value=!0})],64))}});const je={class:"c-subscription-detail__wrapper"},Ae={key:1},Re={class:"c-subscription-detail__content c-display-flex"},Fe={class:"c-details__left c-flex-1"},ze={class:"c-product-details__wrapper"},xe={class:"c-product-details__image"},He=["src"],Ge={class:"c-product-details__content"},Je={class:"c-shopify-header"},Ke={class:"c-shopify-caption"},Qe={class:"c-product-details__qty"},Ye={class:"c-product-details__quantity"},We={class:"c-product-details__price"},Xe={class:"c-product__next-order"},Ze={class:"c-font-bold c-text-700"},et={class:"c-font-bold c-text-700"},tt={class:"c-text-500 c-shipping-address"},st={key:0},at={key:1},nt={key:0},it={key:1},ot={key:2},ct={key:3},rt={key:1},lt={class:"c-details__right"},dt={class:"c-subscription-costs_product c-display-flex c-justify-space-between"},ut={class:"c-subscription-costs_total c-display-flex c-justify-space-between"},pt={class:"c-subscription-cancel"},_t=E({setup(c){const n=X(),i=Z(),l=ge(),{t:h}=ke(),p=P(()=>l.getters.authToken),b=P(()=>l.getters.urlParams),A=P(()=>l.getters.isViewLoading),y=P(()=>l.getters.subscriptionDetail),_=P(()=>{var t,S;return(S=(t=y.value)==null?void 0:t.subscriptionLineItems)==null?void 0:S.subscriptionLineItems[0]}),z=P(()=>{var t,S,O,m;return Pe((S=(t=y.value)==null?void 0:t.billingPolicy)==null?void 0:S.intervalCount,(m=(O=y.value)==null?void 0:O.billingPolicy)==null?void 0:m.interval)}),ae=P(()=>{var t;return h("portal.subscription_details.title",{name:(t=_.value)==null?void 0:t.title,period:z.value})}),v=P(()=>{var t;return((t=y.value)==null?void 0:t.shippingAddress)||{}}),T=j(!1),R=j(!1),[ne,mt,ie,yt,oe]=Me(Y.PAYMENT_METHODS,{enabled:!1});$e(async()=>{var t;await l.dispatch("fetchSubscriptionDetail",{subscriptionId:n.query.subscription_id,authenticationToken:p.value,customerId:(t=b.value)==null?void 0:t.customer_id})});const ce=async()=>{T.value=!0,oe()},re=async t=>{try{R.value=!0,await l.dispatch("updateSubscriptionPaymentMethod",{subscriptionId:y.value.id,paymentMethod:t.id,authenticationToken:p.value,customerId:b.value.customer_id}),T.value=!1,l.dispatch("showToast",{message:h("portal.subscription_details.payment_method_updated"),showToast:!0,variant:"success"}),l.commit("setSubscriptionDetail",{subscriptionContract:Q(K({},y.value),{customerPaymentMethod:t})})}finally{R.value=!0}},le=()=>{T.value=!1},de=async()=>(await l.dispatch("cancelSubscription",{subscriptionId:y.value.id,authenticationToken:p.value,customerId:b.value.customer_id}),i.push({name:Y.SUBSCRIPTIONS,query:{customer_id:b.value.customer_id}}),!0);return(t,S)=>{const O=ee("i18n-t");return o(),u("div",je,[r(Le),e(A)?(o(),I(W,{key:0,fill:"#4F46E5",class:"c-spinner"})):(o(),u("div",Ae,[r(Ie,{title:e(ae)},null,8,["title"]),a("div",Re,[a("div",Fe,[r(L,{title:t.$t("portal.subscription_details.product_details"),class:"c-product-card"},{default:d(()=>{var m,f,g,k,w,D,N,q;return[a("div",ze,[a("div",xe,[a("img",{src:(m=e(_))!=null&&m.variantImage?e(_).variantImage:e(Se)},null,8,He)]),a("div",Ge,[a("p",Je,s((f=e(_))==null?void 0:f.title),1),a("p",Ke,s((g=e(_))==null?void 0:g.variantTitle),1),a("div",Qe,[a("span",Ye,s(t.$t("portal.units"))+": "+s((k=e(_))==null?void 0:k.quantity),1),a("span",We,s((D=(w=e(_))==null?void 0:w.currentPrice)==null?void 0:D.currencyCode)+" "+s((q=(N=e(_))==null?void 0:N.currentPrice)==null?void 0:q.amount),1)])])])]}),_:1},8,["title"]),a("section",Xe,[r(e(Ce),{class:"c-icon__truck"}),r(O,{keypath:"portal.subscription_details.next_order",tag:"span"},{date:d(()=>[a("strong",null,s(e(y).nextOrderDate),1)]),_:1})]),r(L,{title:t.$t("portal.subscription_details.order_frequency"),class:"c-mb-16"},{default:d(()=>[a("p",Ze,s(e(z)),1)]),_:1},8,["title"]),r(L,{title:t.$t("portal.subscription_details.shipping_address"),class:"c-mb-16"},{default:d(()=>{var m,f,g,k;return[a("div",et,s((f=(m=e(y))==null?void 0:m.shippingAddress)==null?void 0:f.firstName)+" "+s((k=(g=e(y))==null?void 0:g.shippingAddress)==null?void 0:k.lastName),1),a("div",tt,[a("div",null,[e(v).address1?(o(),u("span",st,s(e(v).address1),1)):$("",!0),e(v).address2?(o(),u("span",at,s(e(v).address2),1)):$("",!0)]),e(v).zipCode?(o(),u("span",nt,s(e(v).zipCode),1)):$("",!0),e(v).city?(o(),u("span",it,s(e(v).city),1)):$("",!0),e(v).province?(o(),u("span",ot,s(e(v).province),1)):$("",!0),e(v).country?(o(),u("span",ct,s(e(v).country),1)):$("",!0)])]}),_:1},8,["title"]),r(L,{title:t.$t("portal.payment_methods"),action:!T.value&&{link:t.$t("portal.common.edit"),method:"editPayment"},onEditPayment:ce,class:"c-mb-16"},{default:d(()=>[T.value?(o(),u("div",rt,[e(ie)?(o(),I(W,{key:0,fill:"#4F46E5",class:"c-spinner"})):(o(),I(Ue,{key:1,"payment-methods":e(ne),"current-payment":e(y).customerPaymentMethod.id,loading:R.value,onUpdatePayment:re,onCancelUpdatePayment:le},null,8,["payment-methods","current-payment","loading"]))])):(o(),I(se,{key:0,"is-editable":!1,pm:e(y).customerPaymentMethod},null,8,["pm"]))]),_:1},8,["title","action"])]),a("div",lt,[r(L,{title:t.$t("portal.subscription_details.subscription_costs"),class:"c-subscription-costs_wrapper"},{default:d(()=>{var m,f,g,k,w,D,N,q,x,H;return[a("div",dt,[a("span",null,s((m=e(_))==null?void 0:m.title)+" x "+s((f=e(_))==null?void 0:f.quantity),1),a("strong",null,s((k=(g=e(_))==null?void 0:g.currentPrice)==null?void 0:k.currencyCode)+" "+s((D=(w=e(_))==null?void 0:w.currentPrice)==null?void 0:D.amount),1)]),a("div",ut,[a("span",null,s(t.$t("portal.subscription_details.sub_total")),1),a("strong",null,s((q=(N=e(_))==null?void 0:N.currentPrice)==null?void 0:q.currencyCode)+" "+s((H=(x=e(_))==null?void 0:x.currentPrice)==null?void 0:H.amount),1)])]}),_:1},8,["title"])])]),a("div",pt,[r(Ve,{title:t.$t("portal.subscription_details.cancel_subscription")+"?",description:t.$t("portal.subscription_details.cancel_subscription_description")},{default:d(({open:m})=>[r(e(M),{variant:e(B).Link,onClick:m,class:"c-subscription-cancel__link"},{default:d(()=>[C(s(t.$t("portal.subscription_details.cancel_subscription")),1)]),_:2},1032,["variant","onClick"])]),footer:d(({close:m})=>[r(e(M),{onClick:m},{default:d(()=>[C(s(t.$t("portal.common.dismiss")),1)]),_:2},1032,["onClick"]),r(e(M),{variant:e(B).Primary,onClick:f=>de()&&m()},{default:d(()=>[C(s(t.$t("portal.common.confirm")),1)]),_:2},1032,["variant","onClick"])]),_:1},8,["title","description"])])]))])}}});var Pt=F(_t,[["__scopeId","data-v-4194d1e0"]]);export{Pt as default};
