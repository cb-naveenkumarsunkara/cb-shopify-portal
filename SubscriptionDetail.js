var _e=Object.defineProperty,me=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var x=(o,n,i)=>n in o?_e(o,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[n]=i,W=(o,n)=>{for(var i in n||(n={}))ve.call(n,i)&&x(o,i,n[i]);if(Q)for(var i of Q(n))he.call(n,i)&&x(o,i,n[i]);return o},X=(o,n)=>me(o,ye(n));import{d as U,f as c,g as m,h as a,t as s,y as D,w as d,k as f,l as e,J as O,z as S,s as C,G as j,u as ee,x as te,c as be,b as R,j as r,D as fe,F,i as se,r as E,M as z,K as ge,L as ke,a as $e,H as Pe,v as P,O as Ce,Q as Me,o as Se,T as De,U as Ie}from"./index.js";import{_ as Y}from"./plugin-vue_export-helper.js";import{C as we}from"./CreateHeader.js";import{S as Z}from"./Spinner.js";import{M as ae,u as Te}from"./MethodCard.js";const qe={class:"c-portal-card"},Le={class:"c-shopify-header c-display-flex c-justify-space-between"},B=U({props:{title:null,description:null,action:null},setup(o){return(n,i)=>(c(),m("section",qe,[a("div",Le,[a("span",null,s(o.title),1),o.action?(c(),D(e(S),{key:0,class:"c-card-action",variant:e(O).Link,onClick:i[0]||(i[0]=p=>n.$emit(o.action.method))},{default:d(()=>[f(s(n.$t("portal.common.edit")),1)]),_:1},8,["variant"])):C("",!0)]),j(n.$slots,"default")]))}});const Ne={class:"c-breadcrumb-container"},Be={key:0,class:"c-breadcrumb-separator"},Ee=U({setup(o){const n=ee(),i=te(),p=be(()=>{var u;return((u=n.meta)==null?void 0:u.breadcrumbs)||[]}),v=()=>{const u=p.value[p.value.length-1].routeName;i.push({name:u,query:{customer_id:n.query.customer_id}})};return(u,M)=>{const I=R("router-link");return c(),m("section",Ne,[r(e(fe),{class:"c-breadcrumb-back c-cursor-pointer",onClick:v}),(c(!0),m(F,null,se(e(p),(l,y)=>(c(),m("span",null,[y?(c(),m("span",Be,"/")):C("",!0),r(I,{to:{name:l.routeName,query:{customer_id:u.$route.query.customer_id}},class:"c-breadcrumb-link"},{default:d(()=>[f(s(u.$t(l.label)),1)]),_:2},1032,["to"])]))),256))])}}});var Oe=Y(Ee,[["__scopeId","data-v-29ce7164"]]);const Ue={class:"c-select-pm-container"},Ae={class:"pm-edit-ctas"},Ve={class:"c-text-700"},je=U({props:{paymentMethods:null,currentPayment:null,loading:{type:Boolean},fetchingPayments:{type:Boolean}},setup(o){const i=E(o.currentPayment),p=v=>{i.value=v};return(v,u)=>{const M=R("router-link"),I=R("i18n-t");return c(),m(F,null,[a("div",Ue,[(c(!0),m(F,null,se(o.paymentMethods,l=>(c(),D(ae,{key:l.id,pm:l,"is-editable":!1,"is-selectable":!0,"is-selected":i.value.id===l.id,disabled:o.loading,onSelectPayment:p},null,8,["pm","is-selected","disabled"]))),128)),r(e(S),{class:"pm-view-more-cta",disabled:o.loading,loading:o.fetchingPayments,onClick:u[0]||(u[0]=l=>v.$emit("loadMorePayment"))},{default:d(()=>[f(s(v.$t("portal.common.view_more")),1)]),_:1},8,["disabled","loading"])]),a("div",Ae,[r(e(S),{variant:e(O).Primary,class:"pm-update-primary-cta",loading:o.loading,onClick:u[1]||(u[1]=l=>v.$emit("updatePayment",i.value))},{default:d(()=>[f(s(v.$t("portal.subscription_details.update_payment_method")),1)]),_:1},8,["variant","loading"]),r(e(S),{variant:e(O).Link,disabled:o.loading,onClick:u[2]||(u[2]=l=>v.$emit("cancelUpdatePayment"))},{default:d(()=>[f(s(v.$t("portal.common.cancel")),1)]),_:1},8,["variant","disabled"])]),a("p",Ve,[r(I,{keypath:"portal.subscription_details.edit_payment_method"},{payments_page:d(()=>[r(M,{to:{name:e(z).PAYMENT_METHODS,query:{customer_id:v.$route.query.customer_id}}},{default:d(()=>[f(s(v.$t("portal.subscription_details.payment_methods_page")),1)]),_:1},8,["to"])]),_:1})])],64)}}});var Re=Y(je,[["__scopeId","data-v-b799eeb4"]]);const Fe=U({setup(o){const n=E(!1);return(i,p)=>(c(),m(F,null,[r(e(ke),ge({isOpen:n.value,onClose:()=>n.value=!1},i.$attrs),{content:d(()=>[j(i.$slots,"content")]),footer:d(()=>[j(i.$slots,"footer",{close:()=>n.value=!1})]),_:3},16,["isOpen","onClose"]),j(i.$slots,"default",{open:()=>n.value=!0})],64))}});const He={class:"c-subscription-detail__wrapper"},ze={key:1},Ye={class:"c-subscription-detail__content c-display-flex"},Ge={class:"c-details__left c-flex-1"},Je={class:"c-product-details__wrapper"},Ke={class:"c-product-details__image"},Qe=["src"],xe={class:"c-product-details__content"},We={class:"c-shopify-header"},Xe={class:"c-shopify-caption"},Ze={class:"c-product-details__qty"},et={class:"c-product-details__quantity"},tt={class:"c-product-details__price"},st={class:"c-product__next-order"},at={class:"c-font-bold c-text-700"},nt={class:"c-font-bold c-text-700"},it={class:"c-text-500 c-shipping-address"},ot={key:0},ct={key:1},lt={key:0},rt={key:1},dt={key:2},ut={key:3},pt={key:1},_t={class:"c-details__right"},mt={class:"c-subscription-costs_product c-display-flex c-justify-space-between"},yt={class:"c-subscription-costs_total c-display-flex c-justify-space-between"},vt={class:"c-subscription-cancel"},ht=U({setup(o){const n=ee(),i=te(),p=$e(),{t:v}=Pe(),u=P(()=>p.getters.authToken),M=P(()=>p.getters.urlParams),I=P(()=>p.getters.isViewLoading),l=P(()=>p.getters.subscriptionDetail),y=P(()=>{var t,g;return(g=(t=l.value)==null?void 0:t.subscriptionLineItems)==null?void 0:g.subscriptionLineItems[0]}),G=P(()=>{var t,g,V,_;return Ce((g=(t=l.value)==null?void 0:t.billingPolicy)==null?void 0:g.intervalCount,(_=(V=l.value)==null?void 0:V.billingPolicy)==null?void 0:_.interval)}),ne=P(()=>{var t;return v("portal.subscription_details.title",{name:(t=y.value)==null?void 0:t.title,period:G.value})}),h=P(()=>{var t;return((t=l.value)==null?void 0:t.shippingAddress)||{}}),w=E(!1),H=E(!1),[ie,bt,oe,ce,le]=Te(z.PAYMENT_METHODS,{enabled:!1}),A=E([]);Me(ie,t=>{A.value=[...A.value,...t||[]]}),Se(async()=>{var t;await p.dispatch("fetchSubscriptionDetail",{subscriptionId:n.query.subscription_id,authenticationToken:u.value,customerId:(t=M.value)==null?void 0:t.customer_id})});const re=async()=>{w.value=!0,le()},de=async t=>{try{H.value=!0,await p.dispatch("updateSubscriptionPaymentMethod",{subscriptionId:l.value.id,paymentMethod:t.id,authenticationToken:u.value,customerId:M.value.customer_id}),w.value=!1,p.dispatch("showToast",{message:v("portal.subscription_details.payment_method_updated"),showToast:!0,variant:"success"}),p.commit("setSubscriptionDetail",{subscriptionContract:X(W({},l.value),{customerPaymentMethod:t})})}finally{H.value=!0}},ue=()=>{w.value=!1},pe=async()=>(await p.dispatch("cancelSubscription",{subscriptionId:l.value.id,authenticationToken:u.value,customerId:M.value.customer_id}),i.push({name:z.SUBSCRIPTIONS,query:{customer_id:M.value.customer_id}}),!0);return(t,g)=>{const V=R("i18n-t");return c(),m("div",He,[r(Oe),e(I)?(c(),D(Z,{key:0,fill:"#4F46E5",class:"c-spinner"})):(c(),m("div",ze,[r(we,{title:e(ne)},null,8,["title"]),a("div",Ye,[a("div",Ge,[r(B,{title:t.$t("portal.subscription_details.product_details"),class:"c-product-card"},{default:d(()=>{var _,b,k,$,T,q,L,N;return[a("div",Je,[a("div",Ke,[a("img",{src:(_=e(y))!=null&&_.variantImage?e(y).variantImage:e(Ie)},null,8,Qe)]),a("div",xe,[a("p",We,s((b=e(y))==null?void 0:b.title),1),a("p",Xe,s((k=e(y))==null?void 0:k.variantTitle),1),a("div",Ze,[a("span",et,s(t.$t("portal.units"))+": "+s(($=e(y))==null?void 0:$.quantity),1),a("span",tt,s((q=(T=e(y))==null?void 0:T.lineDiscountPrice)==null?void 0:q.currencyCode)+" "+s((N=(L=e(y))==null?void 0:L.lineDiscountPrice)==null?void 0:N.amount),1)])])])]}),_:1},8,["title"]),a("section",st,[r(e(De),{class:"c-icon__truck"}),r(V,{keypath:"portal.subscription_details.next_order",tag:"span"},{date:d(()=>[a("strong",null,s(e(l).nextOrderDate),1)]),_:1})]),r(B,{title:t.$t("portal.subscription_details.order_frequency"),class:"c-mb-16"},{default:d(()=>[a("p",at,s(e(G)),1)]),_:1},8,["title"]),r(B,{title:t.$t("portal.subscription_details.shipping_address"),class:"c-mb-16"},{default:d(()=>{var _,b,k,$;return[a("div",nt,s((b=(_=e(l))==null?void 0:_.shippingAddress)==null?void 0:b.firstName)+" "+s(($=(k=e(l))==null?void 0:k.shippingAddress)==null?void 0:$.lastName),1),a("div",it,[a("div",null,[e(h).address1?(c(),m("span",ot,s(e(h).address1),1)):C("",!0),e(h).address2?(c(),m("span",ct,s(e(h).address2),1)):C("",!0)]),e(h).zipCode?(c(),m("span",lt,s(e(h).zipCode),1)):C("",!0),e(h).city?(c(),m("span",rt,s(e(h).city),1)):C("",!0),e(h).province?(c(),m("span",dt,s(e(h).province),1)):C("",!0),e(h).country?(c(),m("span",ut,s(e(h).country),1)):C("",!0)])]}),_:1},8,["title"]),r(B,{title:t.$t("portal.payment_methods"),action:!w.value&&{link:t.$t("portal.common.edit"),method:"editPayment"},onEditPayment:re,class:"c-mb-16"},{default:d(()=>[w.value?(c(),m("div",pt,[A.value.length?(c(),D(Re,{key:1,"payment-methods":A.value,"current-payment":e(l).customerPaymentMethod,loading:H.value,"fetching-payments":e(oe),onUpdatePayment:de,onCancelUpdatePayment:ue,onLoadMorePayment:g[0]||(g[0]=_=>e(ce).next())},null,8,["payment-methods","current-payment","loading","fetching-payments"])):(c(),D(Z,{key:0,fill:"#4F46E5",class:"c-spinner"}))])):(c(),D(ae,{key:0,"is-editable":!1,pm:e(l).customerPaymentMethod},null,8,["pm"]))]),_:1},8,["title","action"])]),a("div",_t,[r(B,{title:t.$t("portal.subscription_details.subscription_costs"),class:"c-subscription-costs_wrapper"},{default:d(()=>{var _,b,k,$,T,q,L,N,J,K;return[a("div",mt,[a("span",null,s((_=e(y))==null?void 0:_.title)+" x "+s((b=e(y))==null?void 0:b.quantity),1),a("strong",null,s(($=(k=e(y))==null?void 0:k.lineDiscountPrice)==null?void 0:$.currencyCode)+" "+s((q=(T=e(y))==null?void 0:T.lineDiscountPrice)==null?void 0:q.amount),1)]),a("div",yt,[a("span",null,s(t.$t("portal.subscription_details.sub_total")),1),a("strong",null,s((N=(L=e(y))==null?void 0:L.lineDiscountPrice)==null?void 0:N.currencyCode)+" "+s((K=(J=e(y))==null?void 0:J.lineDiscountPrice)==null?void 0:K.amount),1)])]}),_:1},8,["title"])])]),a("div",vt,[r(Fe,{title:t.$t("portal.subscription_details.cancel_subscription")+"?",description:t.$t("portal.subscription_details.cancel_subscription_description")},{default:d(({open:_})=>[r(e(S),{variant:e(O).Link,onClick:_,class:"c-subscription-cancel__link"},{default:d(()=>[f(s(t.$t("portal.subscription_details.cancel_subscription")),1)]),_:2},1032,["variant","onClick"])]),footer:d(({close:_})=>[r(e(S),{onClick:_},{default:d(()=>[f(s(t.$t("portal.common.dismiss")),1)]),_:2},1032,["onClick"]),r(e(S),{variant:e(O).Primary,onClick:b=>pe()&&_()},{default:d(()=>[f(s(t.$t("portal.common.confirm")),1)]),_:2},1032,["variant","onClick"])]),_:1},8,["title","description"])])]))])}}});var Mt=Y(ht,[["__scopeId","data-v-01c582df"]]);export{Mt as default};
