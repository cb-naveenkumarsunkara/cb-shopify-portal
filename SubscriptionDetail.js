var _e=Object.defineProperty,me=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var W=(o,n,i)=>n in o?_e(o,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[n]=i,X=(o,n)=>{for(var i in n||(n={}))ve.call(n,i)&&W(o,i,n[i]);if(Q)for(var i of Q(n))he.call(n,i)&&W(o,i,n[i]);return o},Z=(o,n)=>me(o,ye(n));import{d as V,f as c,g as m,h as a,t as s,y as w,w as d,k as g,l as e,K as O,z as S,s as f,G as j,u as te,x as se,c as be,b as R,j as r,D as fe,F,i as ae,r as E,M as H,L as ge,O as ke,a as Pe,J as $e,v as C,Q as Ce,T as Me,o as we,U as Se,V as De}from"./index.js";import{_ as Y}from"./plugin-vue_export-helper.js";import{C as Ie}from"./CreateHeader.js";import{S as ee}from"./Spinner.js";import{M as ne,u as Te}from"./MethodCard.js";const Ne={class:"c-portal-card"},qe={class:"c-shopify-header c-display-flex c-justify-space-between"},B=V({props:{title:null,description:null,action:null},setup(o){return(n,i)=>(c(),m("section",Ne,[a("div",qe,[a("span",null,s(o.title),1),o.action?(c(),w(e(S),{key:0,class:"c-card-action",variant:e(O).Link,onClick:i[0]||(i[0]=p=>n.$emit(o.action.method))},{default:d(()=>[g(s(n.$t("portal.common.edit")),1)]),_:1},8,["variant"])):f("",!0)]),j(n.$slots,"default")]))}});const Le={class:"c-breadcrumb-container"},Be={key:0,class:"c-breadcrumb-separator"},Ee=V({setup(o){const n=te(),i=se(),p=be(()=>{var u;return((u=n.meta)==null?void 0:u.breadcrumbs)||[]}),v=()=>{const u=p.value[p.value.length-1].routeName;i.push({name:u,query:{customer_id:n.query.customer_id}})};return(u,M)=>{const D=R("router-link");return c(),m("section",Le,[r(e(fe),{class:"c-breadcrumb-back c-cursor-pointer",onClick:v}),(c(!0),m(F,null,ae(e(p),(l,y)=>(c(),m("span",null,[y?(c(),m("span",Be,"/")):f("",!0),r(D,{to:{name:l.routeName,query:{customer_id:u.$route.query.customer_id}},class:"c-breadcrumb-link"},{default:d(()=>[g(s(u.$t(l.label)),1)]),_:2},1032,["to"])]))),256))])}}});var Oe=Y(Ee,[["__scopeId","data-v-29ce7164"]]);const Ve={class:"c-select-pm-container"},Ue={class:"pm-edit-ctas"},Ae={class:"c-text-700"},je=V({props:{paymentMethods:null,currentPayment:null,loading:{type:Boolean},fetchingPayments:{type:Boolean},showViewMore:{type:Boolean}},setup(o){const i=E(o.currentPayment),p=v=>{i.value=v};return(v,u)=>{const M=R("router-link"),D=R("i18n-t");return c(),m(F,null,[a("div",Ve,[(c(!0),m(F,null,ae(o.paymentMethods,l=>(c(),w(ne,{key:l.id,pm:l,"is-editable":!1,"is-selectable":!0,"is-selected":i.value.id===l.id,disabled:o.loading,onSelectPayment:p},null,8,["pm","is-selected","disabled"]))),128)),o.showViewMore?(c(),w(e(S),{key:0,class:"pm-view-more-cta",disabled:o.loading,loading:o.fetchingPayments,onClick:u[0]||(u[0]=l=>v.$emit("loadMorePayment"))},{default:d(()=>[g(s(v.$t("portal.common.view_more")),1)]),_:1},8,["disabled","loading"])):f("",!0)]),a("div",Ue,[r(e(S),{variant:e(O).Primary,class:"pm-update-primary-cta",loading:o.loading,onClick:u[1]||(u[1]=l=>v.$emit("updatePayment",i.value))},{default:d(()=>[g(s(v.$t("portal.subscription_details.update_payment_method")),1)]),_:1},8,["variant","loading"]),r(e(S),{variant:e(O).Link,disabled:o.loading,onClick:u[2]||(u[2]=l=>v.$emit("cancelUpdatePayment"))},{default:d(()=>[g(s(v.$t("portal.common.cancel")),1)]),_:1},8,["variant","disabled"])]),a("p",Ae,[r(D,{keypath:"portal.subscription_details.edit_payment_method"},{payments_page:d(()=>[r(M,{to:{name:e(H).PAYMENT_METHODS,query:{customer_id:v.$route.query.customer_id}}},{default:d(()=>[g(s(v.$t("portal.subscription_details.payment_methods_page")),1)]),_:1},8,["to"])]),_:1})])],64)}}});var Re=Y(je,[["__scopeId","data-v-1d498b32"]]);const Fe=V({setup(o){const n=E(!1);return(i,p)=>(c(),m(F,null,[r(e(ke),ge({isOpen:n.value,onClose:()=>n.value=!1},i.$attrs),{content:d(()=>[j(i.$slots,"content")]),footer:d(()=>[j(i.$slots,"footer",{close:()=>n.value=!1})]),_:3},16,["isOpen","onClose"]),j(i.$slots,"default",{open:()=>n.value=!0})],64))}});const ze={class:"c-subscription-detail__wrapper"},He={key:1},Ye={class:"c-subscription-detail__content c-display-flex"},xe={class:"c-details__left c-flex-1"},Ge={class:"c-product-details__wrapper"},Je={class:"c-product-details__image"},Ke=["src"],Qe={class:"c-product-details__content"},We={class:"c-shopify-header"},Xe={class:"c-shopify-caption"},Ze={class:"c-product-details__qty"},et={class:"c-product-details__quantity"},tt={class:"c-product-details__price"},st={class:"c-product__next-order"},at={class:"c-font-bold c-text-700"},nt={class:"c-font-bold c-text-700"},it={class:"c-text-500 c-shipping-address"},ot={key:0},ct={key:1},lt={key:0},rt={key:1},dt={key:2},ut={key:3},pt={key:1},_t={class:"c-details__right"},mt={class:"c-subscription-costs_product c-display-flex c-justify-space-between"},yt={class:"c-subscription-costs_total c-display-flex c-justify-space-between"},vt={class:"c-subscription-cancel"},ht=V({setup(o){const n=te(),i=se(),p=Pe(),{t:v}=$e(),u=C(()=>p.getters.authToken),M=C(()=>p.getters.urlParams),D=C(()=>p.getters.isViewLoading),l=C(()=>p.getters.subscriptionDetail),y=C(()=>{var t,k;return(k=(t=l.value)==null?void 0:t.subscriptionLineItems)==null?void 0:k.subscriptionLineItems[0]}),x=C(()=>{var t,k,A,_;return Ce((k=(t=l.value)==null?void 0:t.billingPolicy)==null?void 0:k.intervalCount,(_=(A=l.value)==null?void 0:A.billingPolicy)==null?void 0:_.interval)}),ie=C(()=>{var t;return v("portal.subscription_details.title",{name:(t=y.value)==null?void 0:t.title,period:x.value})}),h=C(()=>{var t;return((t=l.value)==null?void 0:t.shippingAddress)||{}}),I=E(!1),z=E(!1),[oe,bt,ce,G,le]=Te(H.PAYMENT_METHODS,{enabled:!1}),U=E([]);Me(oe,t=>{U.value=[...U.value,...t||[]]}),we(async()=>{var t;await p.dispatch("fetchSubscriptionDetail",{subscriptionId:n.query.subscription_id,authenticationToken:u.value,customerId:(t=M.value)==null?void 0:t.customer_id})});const re=async()=>{I.value=!0,le()},de=async t=>{try{z.value=!0,await p.dispatch("updateSubscriptionPaymentMethod",{subscriptionId:l.value.id,paymentMethod:t.id,authenticationToken:u.value,customerId:M.value.customer_id}),I.value=!1,p.dispatch("showToast",{message:v("portal.subscription_details.payment_method_updated"),showToast:!0,variant:"success"}),p.commit("setSubscriptionDetail",{subscriptionContract:Z(X({},l.value),{customerPaymentMethod:t})})}finally{z.value=!0}},ue=()=>{I.value=!1},pe=async()=>(await p.dispatch("cancelSubscription",{subscriptionId:l.value.id,authenticationToken:u.value,customerId:M.value.customer_id}),i.push({name:H.SUBSCRIPTIONS,query:{customer_id:M.value.customer_id}}),!0);return(t,k)=>{const A=R("i18n-t");return c(),m("div",ze,[r(Oe),e(D)?(c(),w(ee,{key:0,fill:"#4F46E5",class:"c-spinner"})):(c(),m("div",He,[r(Ie,{title:e(ie)},null,8,["title"]),a("div",Ye,[a("div",xe,[r(B,{title:t.$t("portal.subscription_details.product_details"),class:"c-product-card"},{default:d(()=>{var _,b,P,$,T,N,q,L;return[a("div",Ge,[a("div",Je,[a("img",{src:(_=e(y))!=null&&_.variantImage?e(y).variantImage:e(De)},null,8,Ke)]),a("div",Qe,[a("p",We,s((b=e(y))==null?void 0:b.title),1),a("p",Xe,s((P=e(y))==null?void 0:P.variantTitle),1),a("div",Ze,[a("span",et,s(t.$t("portal.units"))+": "+s(($=e(y))==null?void 0:$.quantity),1),a("span",tt,s((N=(T=e(y))==null?void 0:T.lineDiscountPrice)==null?void 0:N.currencyCode)+" "+s((L=(q=e(y))==null?void 0:q.lineDiscountPrice)==null?void 0:L.amount),1)])])])]}),_:1},8,["title"]),a("section",st,[r(e(Se),{class:"c-icon__truck"}),r(A,{keypath:"portal.subscription_details.next_order",tag:"span"},{date:d(()=>[a("strong",null,s(e(l).nextOrderDate),1)]),_:1})]),r(B,{title:t.$t("portal.subscription_details.order_frequency"),class:"c-mb-16"},{default:d(()=>[a("p",at,s(e(x)),1)]),_:1},8,["title"]),r(B,{title:t.$t("portal.subscription_details.shipping_address"),class:"c-mb-16"},{default:d(()=>{var _,b,P,$;return[a("div",nt,s((b=(_=e(l))==null?void 0:_.shippingAddress)==null?void 0:b.firstName)+" "+s(($=(P=e(l))==null?void 0:P.shippingAddress)==null?void 0:$.lastName),1),a("div",it,[a("div",null,[e(h).address1?(c(),m("span",ot,s(e(h).address1),1)):f("",!0),e(h).address2?(c(),m("span",ct,s(e(h).address2),1)):f("",!0)]),e(h).zipCode?(c(),m("span",lt,s(e(h).zipCode),1)):f("",!0),e(h).city?(c(),m("span",rt,s(e(h).city),1)):f("",!0),e(h).province?(c(),m("span",dt,s(e(h).province),1)):f("",!0),e(h).country?(c(),m("span",ut,s(e(h).country),1)):f("",!0)])]}),_:1},8,["title"]),r(B,{title:t.$t("portal.payment_methods"),action:!I.value&&{link:t.$t("portal.common.edit"),method:"editPayment"},onEditPayment:re,class:"c-mb-16"},{default:d(()=>[I.value?(c(),m("div",pt,[U.value.length?(c(),w(Re,{key:1,"payment-methods":U.value,"show-view-more":e(G).hasNextPage,"current-payment":e(l).customerPaymentMethod,loading:z.value,"fetching-payments":e(ce),onUpdatePayment:de,onCancelUpdatePayment:ue,onLoadMorePayment:k[0]||(k[0]=_=>e(G).next())},null,8,["payment-methods","show-view-more","current-payment","loading","fetching-payments"])):(c(),w(ee,{key:0,fill:"#4F46E5",class:"c-spinner"}))])):(c(),w(ne,{key:0,"is-editable":!1,pm:e(l).customerPaymentMethod},null,8,["pm"]))]),_:1},8,["title","action"])]),a("div",_t,[r(B,{title:t.$t("portal.subscription_details.subscription_costs"),class:"c-subscription-costs_wrapper"},{default:d(()=>{var _,b,P,$,T,N,q,L,J,K;return[a("div",mt,[a("span",null,s((_=e(y))==null?void 0:_.title)+" x "+s((b=e(y))==null?void 0:b.quantity),1),a("strong",null,s(($=(P=e(y))==null?void 0:P.lineDiscountPrice)==null?void 0:$.currencyCode)+" "+s((N=(T=e(y))==null?void 0:T.lineDiscountPrice)==null?void 0:N.amount),1)]),a("div",yt,[a("span",null,s(t.$t("portal.subscription_details.sub_total")),1),a("strong",null,s((L=(q=e(y))==null?void 0:q.lineDiscountPrice)==null?void 0:L.currencyCode)+" "+s((K=(J=e(y))==null?void 0:J.lineDiscountPrice)==null?void 0:K.amount),1)])]}),_:1},8,["title"])])]),a("div",vt,[r(Fe,{title:t.$t("portal.subscription_details.cancel_subscription")+"?",description:t.$t("portal.subscription_details.cancel_subscription_description")},{default:d(({open:_})=>[r(e(S),{variant:e(O).Link,onClick:_,class:"c-subscription-cancel__link"},{default:d(()=>[g(s(t.$t("portal.subscription_details.cancel_subscription")),1)]),_:2},1032,["variant","onClick"])]),footer:d(({close:_})=>[r(e(S),{onClick:_},{default:d(()=>[g(s(t.$t("portal.common.dismiss")),1)]),_:2},1032,["onClick"]),r(e(S),{variant:e(O).Primary,onClick:b=>pe()&&_()},{default:d(()=>[g(s(t.$t("portal.common.confirm")),1)]),_:2},1032,["variant","onClick"])]),_:1},8,["title","description"])])]))])}}});var Mt=Y(ht,[["__scopeId","data-v-3784a4f4"]]);export{Mt as default};
