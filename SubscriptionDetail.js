var pe=Object.defineProperty,_e=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var W=(o,n,i)=>n in o?pe(o,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[n]=i,X=(o,n)=>{for(var i in n||(n={}))ye.call(n,i)&&W(o,i,n[i]);if(Q)for(var i of Q(n))ve.call(n,i)&&W(o,i,n[i]);return o},Z=(o,n)=>_e(o,me(n));import{d as U,f as c,g as _,h as a,t as s,y as S,w as d,k as g,l as e,K as V,z as M,s as f,G as j,u as ee,x as te,c as he,b as R,j as r,D as be,F,i as se,r as O,M as H,L as fe,O as ge,a as ke,J as Pe,v as C,Q as $e,T as Ce,o as we,U as Me,V as Se,E as De}from"./index.js";import{_ as Y}from"./plugin-vue_export-helper.js";import{C as Ie}from"./CreateHeader.js";import{S as Te}from"./Spinner.js";import{M as ae,u as Ne}from"./MethodCard.js";const qe={class:"c-portal-card"},Le={class:"c-shopify-header c-display-flex c-justify-space-between"},E=U({props:{title:null,description:null,action:null},setup(o){return(n,i)=>(c(),_("section",qe,[a("div",Le,[a("span",null,s(o.title),1),o.action?(c(),S(e(M),{key:0,class:"c-card-action",variant:e(V).Link,onClick:i[0]||(i[0]=u=>n.$emit(o.action.method))},{default:d(()=>[g(s(n.$t("portal.common.edit")),1)]),_:1},8,["variant"])):f("",!0)]),j(n.$slots,"default")]))}});const Be={class:"c-breadcrumb-container"},Ee={key:0,class:"c-breadcrumb-separator"},Oe=U({setup(o){const n=ee(),i=te(),u=he(()=>{var p;return((p=n.meta)==null?void 0:p.breadcrumbs)||[]}),y=()=>{const p=u.value[u.value.length-1].routeName;i.push({name:p,query:{customer_id:n.query.customer_id}})};return(p,w)=>{const D=R("router-link");return c(),_("section",Be,[r(e(be),{class:"c-breadcrumb-back c-cursor-pointer",onClick:y}),(c(!0),_(F,null,se(e(u),(l,v)=>(c(),_("span",null,[v?(c(),_("span",Ee,"/")):f("",!0),r(D,{to:{name:l.routeName,query:{customer_id:p.$route.query.customer_id}},class:"c-breadcrumb-link"},{default:d(()=>[g(s(p.$t(l.label)),1)]),_:2},1032,["to"])]))),256))])}}});var Ve=Y(Oe,[["__scopeId","data-v-29ce7164"]]);const Ue={class:"c-select-pm-container"},Ae={class:"pm-edit-ctas"},je={class:"c-text-700"},Re=U({props:{paymentMethods:null,currentPayment:null,loading:{type:Boolean},fetchingPayments:{type:Boolean},showViewMore:{type:Boolean}},setup(o){const i=O(o.currentPayment),u=y=>{i.value=y};return(y,p)=>{const w=R("router-link"),D=R("i18n-t");return c(),_(F,null,[a("div",Ue,[(c(!0),_(F,null,se(o.paymentMethods,l=>(c(),S(ae,{key:l.id,pm:l,"is-editable":!1,"is-selectable":!0,"is-selected":i.value.id===l.id,disabled:o.loading,onSelectPayment:u},null,8,["pm","is-selected","disabled"]))),128)),o.showViewMore?(c(),S(e(M),{key:0,class:"pm-view-more-cta",disabled:o.loading,loading:o.fetchingPayments,onClick:p[0]||(p[0]=l=>y.$emit("loadMorePayment"))},{default:d(()=>[g(s(y.$t("portal.common.view_more")),1)]),_:1},8,["disabled","loading"])):f("",!0)]),a("div",Ae,[r(e(M),{variant:e(V).Primary,class:"pm-update-primary-cta",loading:o.loading,onClick:p[1]||(p[1]=l=>y.$emit("updatePayment",i.value))},{default:d(()=>[g(s(y.$t("portal.subscription_details.update_payment_method")),1)]),_:1},8,["variant","loading"]),r(e(M),{variant:e(V).Link,disabled:o.loading,onClick:p[2]||(p[2]=l=>y.$emit("cancelUpdatePayment"))},{default:d(()=>[g(s(y.$t("portal.common.cancel")),1)]),_:1},8,["variant","disabled"])]),a("p",je,[r(D,{keypath:"portal.subscription_details.edit_payment_method"},{payments_page:d(()=>[r(w,{to:{name:e(H).PAYMENT_METHODS,query:{customer_id:y.$route.query.customer_id}}},{default:d(()=>[g(s(y.$t("portal.subscription_details.payment_methods_page")),1)]),_:1},8,["to"])]),_:1})])],64)}}});var Fe=Y(Re,[["__scopeId","data-v-1d498b32"]]);const ze=U({setup(o){const n=O(!1);return(i,u)=>(c(),_(F,null,[r(e(ge),fe({isOpen:n.value,onClose:()=>n.value=!1},i.$attrs),{content:d(()=>[j(i.$slots,"content")]),footer:d(()=>[j(i.$slots,"footer",{close:()=>n.value=!1})]),_:3},16,["isOpen","onClose"]),j(i.$slots,"default",{open:()=>n.value=!0})],64))}});const He={class:"c-subscription-detail__wrapper"},Ye={key:1},xe={class:"c-subscription-detail__content c-display-flex"},Ge={class:"c-details__left c-flex-1"},Je={class:"c-product-details__wrapper"},Ke={class:"c-product-details__image"},Qe=["src"],We={class:"c-product-details__content"},Xe={class:"c-shopify-header"},Ze={class:"c-shopify-caption"},et={class:"c-product-details__qty"},tt={class:"c-product-details__quantity"},st={class:"c-product-details__price"},at={class:"c-product__next-order"},nt={class:"c-font-bold c-text-700"},it={class:"c-font-bold c-text-700"},ot={class:"c-text-500 c-shipping-address"},ct={key:0},lt={key:1},rt={key:0},dt={key:1},ut={key:2},pt={key:3},_t={key:1},mt={key:0,class:"c-spinner-container"},yt={class:"c-details__right"},vt={class:"c-subscription-costs_product c-display-flex c-justify-space-between"},ht={class:"c-subscription-costs_total c-display-flex c-justify-space-between"},bt={class:"c-subscription-cancel"},ft=U({setup(o){const n=ee(),i=te(),u=ke(),{t:y}=Pe(),p=C(()=>u.getters.authToken),w=C(()=>u.getters.urlParams),D=C(()=>u.getters.isViewLoading),l=C(()=>u.getters.subscriptionDetail),v=C(()=>{var t,k;return(k=(t=l.value)==null?void 0:t.subscriptionLineItems)==null?void 0:k.subscriptionLineItems[0]}),x=C(()=>{var t,k,A,m;return $e((k=(t=l.value)==null?void 0:t.billingPolicy)==null?void 0:k.intervalCount,(m=(A=l.value)==null?void 0:A.billingPolicy)==null?void 0:m.interval)}),ne=C(()=>{var t;return y("portal.subscription_details.title",{name:(t=v.value)==null?void 0:t.title,period:x.value})}),h=C(()=>{var t;return((t=l.value)==null?void 0:t.shippingAddress)||{}}),I=O(!1),z=O(!1),[ie,gt,oe,G,ce]=Ne(H.PAYMENT_METHODS,{enabled:!1}),T=O([]);Ce(ie,t=>{T.value=[...T.value,...t||[]]}),we(async()=>{var t;await u.dispatch("fetchSubscriptionDetail",{subscriptionId:n.query.subscription_id,authenticationToken:p.value,customerId:(t=w.value)==null?void 0:t.customer_id})});const le=async()=>{I.value=!0,T.value.length||ce()},re=async t=>{try{z.value=!0,await u.dispatch("updateSubscriptionPaymentMethod",{subscriptionId:l.value.id,paymentMethod:t.id,authenticationToken:p.value,customerId:w.value.customer_id}),I.value=!1,u.dispatch("showToast",{message:y("portal.subscription_details.payment_method_updated"),showToast:!0,variant:"success"}),u.commit("setSubscriptionDetail",{subscriptionContract:Z(X({},l.value),{customerPaymentMethod:t})})}finally{z.value=!1}},de=()=>{I.value=!1},ue=async()=>(await u.dispatch("cancelSubscription",{subscriptionId:l.value.id,authenticationToken:p.value,customerId:w.value.customer_id}),u.dispatch("showToast",{message:y("portal.subscription_details.cancel_subscription_success"),showToast:!0,variant:"success"}),i.push({name:H.SUBSCRIPTIONS,query:{customer_id:w.value.customer_id}}),!0);return(t,k)=>{const A=R("i18n-t");return c(),_("div",He,[r(Ve),e(D)?(c(),S(Te,{key:0,fill:"#4F46E5",class:"c-spinner"})):(c(),_("div",Ye,[r(Ie,{title:e(ne)},null,8,["title"]),a("div",xe,[a("div",Ge,[r(E,{title:t.$t("portal.subscription_details.product_details"),class:"c-product-card"},{default:d(()=>{var m,b,P,$,N,q,L,B;return[a("div",Je,[a("div",Ke,[a("img",{src:(m=e(v))!=null&&m.variantImage?e(v).variantImage:e(Se)},null,8,Qe)]),a("div",We,[a("p",Xe,s((b=e(v))==null?void 0:b.title),1),a("p",Ze,s((P=e(v))==null?void 0:P.variantTitle),1),a("div",et,[a("span",tt,s(t.$t("portal.units"))+": "+s(($=e(v))==null?void 0:$.quantity),1),a("span",st,s((q=(N=e(v))==null?void 0:N.lineDiscountPrice)==null?void 0:q.currencyCode)+" "+s((B=(L=e(v))==null?void 0:L.lineDiscountPrice)==null?void 0:B.amount),1)])])])]}),_:1},8,["title"]),a("section",at,[r(e(Me),{class:"c-icon__truck"}),r(A,{keypath:"portal.subscription_details.next_order",tag:"span"},{date:d(()=>[a("strong",null,s(e(l).nextOrderDate),1)]),_:1})]),r(E,{title:t.$t("portal.subscription_details.order_frequency"),class:"c-mb-16"},{default:d(()=>[a("p",nt,s(e(x)),1)]),_:1},8,["title"]),r(E,{title:t.$t("portal.subscription_details.shipping_address"),class:"c-mb-16"},{default:d(()=>{var m,b,P,$;return[a("div",it,s((b=(m=e(l))==null?void 0:m.shippingAddress)==null?void 0:b.firstName)+" "+s(($=(P=e(l))==null?void 0:P.shippingAddress)==null?void 0:$.lastName),1),a("div",ot,[a("div",null,[e(h).address1?(c(),_("span",ct,s(e(h).address1),1)):f("",!0),e(h).address2?(c(),_("span",lt,s(e(h).address2),1)):f("",!0)]),e(h).zipCode?(c(),_("span",rt,s(e(h).zipCode),1)):f("",!0),e(h).city?(c(),_("span",dt,s(e(h).city),1)):f("",!0),e(h).province?(c(),_("span",ut,s(e(h).province),1)):f("",!0),e(h).country?(c(),_("span",pt,s(e(h).country),1)):f("",!0)])]}),_:1},8,["title"]),r(E,{title:t.$t("portal.payment_methods"),action:!I.value&&{link:t.$t("portal.common.update"),method:"editPayment"},onEditPayment:le,class:"c-mb-16"},{default:d(()=>[I.value?(c(),_("div",_t,[T.value.length?(c(),S(Fe,{key:1,"payment-methods":T.value,"show-view-more":e(G).hasNextPage,"current-payment":e(l).customerPaymentMethod,loading:z.value,"fetching-payments":e(oe),onUpdatePayment:re,onCancelUpdatePayment:de,onLoadMorePayment:k[0]||(k[0]=m=>e(G).next())},null,8,["payment-methods","show-view-more","current-payment","loading","fetching-payments"])):(c(),_("div",mt,[r(e(De),{fill:"#4F46E5",class:"c-spinner"})]))])):(c(),S(ae,{key:0,"is-editable":!1,pm:e(l).customerPaymentMethod},null,8,["pm"]))]),_:1},8,["title","action"])]),a("div",yt,[r(E,{title:t.$t("portal.subscription_details.subscription_costs"),class:"c-subscription-costs_wrapper"},{default:d(()=>{var m,b,P,$,N,q,L,B,J,K;return[a("div",vt,[a("span",null,s((m=e(v))==null?void 0:m.title)+" x "+s((b=e(v))==null?void 0:b.quantity),1),a("strong",null,s(($=(P=e(v))==null?void 0:P.lineDiscountPrice)==null?void 0:$.currencyCode)+" "+s((q=(N=e(v))==null?void 0:N.lineDiscountPrice)==null?void 0:q.amount),1)]),a("div",ht,[a("span",null,s(t.$t("portal.subscription_details.sub_total")),1),a("strong",null,s((B=(L=e(v))==null?void 0:L.lineDiscountPrice)==null?void 0:B.currencyCode)+" "+s((K=(J=e(v))==null?void 0:J.lineDiscountPrice)==null?void 0:K.amount),1)])]}),_:1},8,["title"])])]),a("div",bt,[r(ze,{title:t.$t("portal.subscription_details.cancel_subscription")+"?",description:t.$t("portal.subscription_details.cancel_subscription_description")},{default:d(({open:m})=>[r(e(M),{variant:e(V).Link,onClick:m,class:"c-subscription-cancel__link"},{default:d(()=>[g(s(t.$t("portal.subscription_details.cancel_subscription")),1)]),_:2},1032,["variant","onClick"])]),footer:d(({close:m})=>[r(e(M),{onClick:m},{default:d(()=>[g(s(t.$t("portal.common.dismiss")),1)]),_:2},1032,["onClick"]),r(e(M),{variant:e(V).Primary,onClick:b=>ue()&&m()},{default:d(()=>[g(s(t.$t("portal.common.confirm")),1)]),_:2},1032,["variant","onClick"])]),_:1},8,["title","description"])])]))])}}});var St=Y(ft,[["__scopeId","data-v-602752f6"]]);export{St as default};
