var lt=Object.defineProperty,dt=Object.defineProperties;var ut=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var pt=Object.prototype.hasOwnProperty,_t=Object.prototype.propertyIsEnumerable;var K=(c,i,n)=>i in c?lt(c,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[i]=n,Q=(c,i)=>{for(var n in i||(i={}))pt.call(i,n)&&K(c,n,i[n]);if(J)for(var n of J(i))_t.call(i,n)&&K(c,n,i[n]);return c},W=(c,i)=>dt(c,ut(i));import{d as E,f as o,g as p,h as a,t as s,y as S,w as u,k as C,l as t,I as O,z as M,s as P,G as V,u as Y,x as Z,c as mt,b as tt,j as l,D as yt,F as j,i as et,r as B,J as vt,K as ht,a as bt,H as ft,v as k,L as kt,o as gt,O as $t,Q as Pt,M as Ct}from"./index.js";import{_ as z}from"./plugin-vue_export-helper.js";import{C as It}from"./CreateHeader.js";import{S as X}from"./Spinner.js";import{M as st}from"./MethodCard.js";const St={class:"c-portal-card"},Mt={class:"c-shopify-header c-display-flex c-justify-space-between"},N=E({props:{title:null,description:null,action:null},setup(c){return(i,n)=>(o(),p("section",St,[a("div",Mt,[a("span",null,s(c.title),1),c.action?(o(),S(t(M),{key:0,class:"c-card-action",variant:t(O).Link,onClick:n[0]||(n[0]=r=>i.$emit(c.action.method))},{default:u(()=>[C(s(i.$t("portal.common.edit")),1)]),_:1},8,["variant"])):P("",!0)]),V(i.$slots,"default")]))}});const wt={class:"c-breadcrumb-container"},Tt={key:0,class:"c-breadcrumb-separator"},Dt=E({setup(c){const i=Y(),n=Z(),r=mt(()=>{var d;return((d=i.meta)==null?void 0:d.breadcrumbs)||[]}),b=()=>{const d=r.value[r.value.length-1].routeName;n.push({name:d,query:{customer_id:i.query.customer_id}})};return(d,v)=>{const R=tt("router-link");return o(),p("section",wt,[l(t(yt),{class:"c-breadcrumb-back c-cursor-pointer",onClick:b}),(o(!0),p(j,null,et(t(r),(y,_)=>(o(),p("span",null,[_?(o(),p("span",Tt,"/")):P("",!0),l(R,{to:{name:y.routeName,query:{customer_id:d.$route.query.customer_id}},class:"c-breadcrumb-link"},{default:u(()=>[C(s(d.$t(y.label)),1)]),_:2},1032,["to"])]))),256))])}}});var qt=z(Dt,[["__scopeId","data-v-29ce7164"]]);const Lt={class:"c-select-pm-container"},Nt={class:"pm-edit-ctas"},Bt=E({props:{paymentMethods:null,currentPayment:null,loading:{type:Boolean}},setup(c){const n=B(c.currentPayment),r=b=>{n.value=b};return(b,d)=>(o(),p(j,null,[a("div",Lt,[(o(!0),p(j,null,et(c.paymentMethods,v=>(o(),S(st,{key:v.id,pm:v,"is-editable":!1,"is-selectable":!0,"is-selected":n.value.id===v.id,disabled:c.loading,onSelectPayment:r},null,8,["pm","is-selected","disabled"]))),128))]),a("div",Nt,[l(t(M),{variant:t(O).Primary,class:"pm-update-primary-cta",loading:c.loading,onClick:d[0]||(d[0]=v=>b.$emit("updatePayment",n.value))},{default:u(()=>[C(s(b.$t("portal.subscription_details.update_payment_method")),1)]),_:1},8,["variant","loading"]),l(t(M),{variant:t(O).Link,disabled:c.loading,onClick:d[1]||(d[1]=v=>b.$emit("cancelUpdatePayment"))},{default:u(()=>[C(s(b.$t("portal.common.cancel")),1)]),_:1},8,["variant","disabled"])])],64))}});var Ot=z(Bt,[["__scopeId","data-v-273e7e82"]]);const Et=E({setup(c){const i=B(!1);return(n,r)=>(o(),p(j,null,[l(t(ht),vt({isOpen:i.value,onClose:()=>i.value=!1},n.$attrs),{content:u(()=>[V(n.$slots,"content")]),footer:u(()=>[V(n.$slots,"footer",{close:()=>i.value=!1})]),_:3},16,["isOpen","onClose"]),V(n.$slots,"default",{open:()=>i.value=!0})],64))}});const Ut={class:"c-subscription-detail__wrapper"},Vt={key:1},jt={class:"c-subscription-detail__content c-display-flex"},Rt={class:"c-details__left c-flex-1"},At={class:"c-product-details__wrapper"},Ft={class:"c-product-details__image"},zt=["src"],Ht={class:"c-product-details__content"},xt={class:"c-shopify-header"},Gt={class:"c-shopify-caption"},Jt={class:"c-product-details__qty"},Kt={class:"c-product-details__quantity"},Qt={class:"c-product-details__price"},Wt={class:"c-product__next-order"},Xt={class:"c-font-bold c-text-700"},Yt={class:"c-font-bold c-text-700"},Zt={class:"c-text-500 c-shipping-address"},te={key:0},ee={key:1},se={key:0},ae={key:1},ie={key:2},ne={key:3},oe={key:1},ce={class:"c-details__right"},re={class:"c-subscription-costs_product c-display-flex c-justify-space-between"},le={class:"c-subscription-costs_total c-display-flex c-justify-space-between"},de={class:"c-subscription-cancel"},ue=E({setup(c){const i=Y(),n=Z(),r=bt(),{t:b}=ft(),d=k(()=>r.getters.authToken),v=k(()=>r.getters.urlParams),R=k(()=>r.getters.isViewLoading),y=k(()=>r.getters.subscriptionDetail),_=k(()=>{var e,I;return(I=(e=y.value)==null?void 0:e.subscriptionLineItems)==null?void 0:I.subscriptionLineItems[0]}),H=k(()=>{var e,I,U,m;return kt((I=(e=y.value)==null?void 0:e.billingPolicy)==null?void 0:I.intervalCount,(m=(U=y.value)==null?void 0:U.billingPolicy)==null?void 0:m.interval)}),at=k(()=>{var e;return b("portal.subscription_details.title",{name:(e=_.value)==null?void 0:e.title,period:H.value})}),h=k(()=>{var e;return((e=y.value)==null?void 0:e.shippingAddress)||{}}),w=B(!1),A=B(!1),F=B(!1),it=k(()=>r.getters.paymentMethods);gt(async()=>{var e;await r.dispatch("fetchSubscriptionDetail",{subscriptionId:i.query.subscription_id,authenticationToken:d.value,customerId:(e=v.value)==null?void 0:e.customer_id})});const nt=async()=>{var e;w.value=!0,A.value=!0;try{await r.dispatch("listPaymentMethods",{authenticationToken:d.value,customerId:(e=v.value)==null?void 0:e.customer_id})}finally{A.value=!1}},ot=async e=>{try{F.value=!0,await r.dispatch("updateSubscriptionPaymentMethod",{subscriptionId:y.value.id,paymentMethod:e.id,authenticationToken:d.value,customerId:v.value.customer_id}),w.value=!1,r.dispatch("showToast",{message:b("portal.subscription_details.payment_method_updated"),showToast:!0,variant:"success"}),r.commit("setSubscriptionDetail",{subscriptionContract:W(Q({},y.value),{customerPaymentMethod:e})})}finally{F.value=!0}},ct=()=>{w.value=!1},rt=async()=>(await r.dispatch("cancelSubscription",{subscriptionId:y.value.id,authenticationToken:d.value,customerId:v.value.customer_id}),n.push({name:Ct.SUBSCRIPTIONS,query:{customer_id:v.value.customer_id}}),!0);return(e,I)=>{const U=tt("i18n-t");return o(),p("div",Ut,[l(qt),t(R)?(o(),S(X,{key:0,fill:"#4F46E5",class:"c-spinner"})):(o(),p("div",Vt,[l(It,{title:t(at)},null,8,["title"]),a("div",jt,[a("div",Rt,[l(N,{title:e.$t("portal.subscription_details.product_details"),class:"c-product-card"},{default:u(()=>{var m,f,g,$,T,D,q,L;return[a("div",At,[a("div",Ft,[a("img",{src:(m=t(_))!=null&&m.variantImage?t(_).variantImage:t(Pt)},null,8,zt)]),a("div",Ht,[a("p",xt,s((f=t(_))==null?void 0:f.title),1),a("p",Gt,s((g=t(_))==null?void 0:g.variantTitle),1),a("div",Jt,[a("span",Kt,s(e.$t("portal.units"))+": "+s(($=t(_))==null?void 0:$.quantity),1),a("span",Qt,s((D=(T=t(_))==null?void 0:T.currentPrice)==null?void 0:D.currencyCode)+" "+s((L=(q=t(_))==null?void 0:q.currentPrice)==null?void 0:L.amount),1)])])])]}),_:1},8,["title"]),a("section",Wt,[l(t($t),{class:"c-icon__truck"}),l(U,{keypath:"portal.subscription_details.next_order",tag:"span"},{date:u(()=>[a("strong",null,s(t(y).nextOrderDate),1)]),_:1})]),l(N,{title:e.$t("portal.subscription_details.order_frequency"),class:"c-mb-16"},{default:u(()=>[a("p",Xt,s(t(H)),1)]),_:1},8,["title"]),l(N,{title:e.$t("portal.subscription_details.shipping_address"),class:"c-mb-16"},{default:u(()=>{var m,f,g,$;return[a("div",Yt,s((f=(m=t(y))==null?void 0:m.shippingAddress)==null?void 0:f.firstName)+" "+s(($=(g=t(y))==null?void 0:g.shippingAddress)==null?void 0:$.lastName),1),a("div",Zt,[a("div",null,[t(h).address1?(o(),p("span",te,s(t(h).address1),1)):P("",!0),t(h).address2?(o(),p("span",ee,s(t(h).address2),1)):P("",!0)]),t(h).zipCode?(o(),p("span",se,s(t(h).zipCode),1)):P("",!0),t(h).city?(o(),p("span",ae,s(t(h).city),1)):P("",!0),t(h).province?(o(),p("span",ie,s(t(h).province),1)):P("",!0),t(h).country?(o(),p("span",ne,s(t(h).country),1)):P("",!0)])]}),_:1},8,["title"]),l(N,{title:e.$t("portal.payment_methods"),action:!w.value&&{link:e.$t("portal.common.edit"),method:"editPayment"},onEditPayment:nt,class:"c-mb-16"},{default:u(()=>[w.value?(o(),p("div",oe,[A.value?(o(),S(X,{key:0,fill:"#4F46E5",class:"c-spinner"})):(o(),S(Ot,{key:1,"payment-methods":t(it),"current-payment":t(y).customerPaymentMethod.id,loading:F.value,onUpdatePayment:ot,onCancelUpdatePayment:ct},null,8,["payment-methods","current-payment","loading"]))])):(o(),S(st,{key:0,"is-editable":!1,pm:t(y).customerPaymentMethod},null,8,["pm"]))]),_:1},8,["title","action"])]),a("div",ce,[l(N,{title:e.$t("portal.subscription_details.subscription_costs"),class:"c-subscription-costs_wrapper"},{default:u(()=>{var m,f,g,$,T,D,q,L,x,G;return[a("div",re,[a("span",null,s((m=t(_))==null?void 0:m.title)+" x "+s((f=t(_))==null?void 0:f.quantity),1),a("strong",null,s(($=(g=t(_))==null?void 0:g.currentPrice)==null?void 0:$.currencyCode)+" "+s((D=(T=t(_))==null?void 0:T.currentPrice)==null?void 0:D.amount),1)]),a("div",le,[a("span",null,s(e.$t("portal.subscription_details.sub_total")),1),a("strong",null,s((L=(q=t(_))==null?void 0:q.currentPrice)==null?void 0:L.currencyCode)+" "+s((G=(x=t(_))==null?void 0:x.currentPrice)==null?void 0:G.amount),1)])]}),_:1},8,["title"])])]),a("div",de,[l(Et,{title:e.$t("portal.subscription_details.cancel_subscription")+"?",description:e.$t("portal.subscription_details.cancel_subscription_description")},{default:u(({open:m})=>[l(t(M),{variant:t(O).Link,onClick:m,class:"c-subscription-cancel__link"},{default:u(()=>[C(s(e.$t("portal.subscription_details.cancel_subscription")),1)]),_:2},1032,["variant","onClick"])]),footer:u(({close:m})=>[l(t(M),{onClick:m},{default:u(()=>[C(s(e.$t("portal.common.dismiss")),1)]),_:2},1032,["onClick"]),l(t(M),{variant:t(O).Primary,onClick:f=>rt()&&m()},{default:u(()=>[C(s(e.$t("portal.common.confirm")),1)]),_:2},1032,["variant","onClick"])]),_:1},8,["title","description"])])]))])}}});var be=z(ue,[["__scopeId","data-v-58dc7f64"]]);export{be as default};
