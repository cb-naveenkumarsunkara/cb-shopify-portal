import{M as J,r as T,a as F,v as d,S as q,I as Y,P as $,d as z,J as D,f as u,g as v,h as s,l as a,s as C,t as o,F as x,k as S,y as H,w as L,K as E,z as U,j as B,n as K}from"./index.js";import{_ as X}from"./plugin-vue_export-helper.js";const Q={[J.PAYMENT_METHODS]:"listPaymentmethod",[J.SUBSCRIPTIONS]:"listSubscriptions"};function Se(e,O={enabled:!0}){const f=T(null),m=T(null),g=T(null),h=T(!1),b=F(),y=d(()=>b.getters.authToken),_=d(()=>b.getters.urlParams),I=d(()=>{const p=m.value;if(p){const{hasNextPage:k,hasPreviousPage:w}=p;return{hasNextPage:k,hasPreviousPage:w,next:()=>{var c,n;if(k){const{value:l}=f;if(!l&&!l.length)return"";const i=l.length,M=(n=(c=l[i-1])==null?void 0:c.cursor)!=null?n:"";return P({first:$[e],after:M})}},prev:()=>{var c,n;if(w){const{value:l}=f;if(!l&&!l.length)return"";const i=(n=(c=l[0])==null?void 0:c.cursor)!=null?n:"";return P({last:$[e],before:i})}}}}return null});async function P(p={}){var l;const{after:k=null,before:w=null,first:c=null,last:n=null}=p;f.value=null,g.value=null,h.value=!0;try{const i=await q[Q[e]](y.value,(l=_.value)==null?void 0:l.customer_id,null,null,null,null,k,w,c,n,!0);f.value=i[Y[e]],m.value=i.pageInfo}catch(i){i.value=i}finally{h.value=!1}}return O.enabled&&P({first:$[e]}),[f,g,h,I,()=>P({first:$[e]})]}var W="https://cb-shopify-portal.netlify.app/visa.svg",Z="https://cb-shopify-portal.netlify.app/jcb.svg",N="https://cb-shopify-portal.netlify.app/mastercard.svg",A="https://cb-shopify-portal.netlify.app/unionpay.svg",R="https://cb-shopify-portal.netlify.app/amex.svg",ee="https://cb-shopify-portal.netlify.app/dinersclub.svg",te="https://cb-shopify-portal.netlify.app/discover.svg",ae="https://cb-shopify-portal.netlify.app/paypal.svg",se="https://cb-shopify-portal.netlify.app/apple-pay.svg",ne="https://cb-shopify-portal.netlify.app/google-pay.svg",le="https://cb-shopify-portal.netlify.app/shop-pay.svg",oe="https://cb-shopify-portal.netlify.app/card.svg",V=(e=>(e.visa="Visa",e.mastercard="MasterCard",e.american_express="American Express",e.discover="Discover",e.diners_club="Diners Club",e.jcb="JCB",e.unionpay="UnionPay",e.unknown="Card",e))(V||{});const ie={key:0,class:"pm-radio-container"},re=["value","id","checked","disabled"],de={class:"pm-info-wrapper"},pe={class:"pm-info"},ce=["src"],ue={class:"pm-title"},me={class:"pm-status"},he={class:"pm-timeline","data-testid":"timeline"},ye={key:1,"data-testid":"method-inactive"},ve={key:0},fe={key:1,class:"pm-edit-container","data-testid":"edit-container"},ge={class:"pm-edit-info"},be={class:"pm-edit-note"},_e={class:"pm-edit-ctas"},Pe=z({props:{pm:Object,isEditable:{type:Boolean,required:!1,default:!0},isSelectable:{type:Boolean,required:!1,default:!1},isSelected:{type:Boolean,required:!1,default:!1},disabled:{type:Boolean,required:!1,default:!1}},setup(e){const O=e,f={visa:W,jcb:Z,american_express:R,diners_club:ee,discover:te,mastercard:N,unionpay:A},{t:m}=D(),g=T(!1),h=T(!1),b=d(()=>{const{lastDigits:t,brand:r,paypalAccountEmail:j,source:G}=n.value;if(k.value)switch(G){case"apple_pay":return{title:m("portal.payment_method.card_ending",{method:"Apple Pay",lastDigits:t}),logo:se};case"google_pay":return{title:m("portal.payment_method.card_ending",{method:"GPay",lastDigits:t}),logo:ne};default:return{title:m("portal.payment_method.card_ending",{method:V[r]||V.unknown,lastDigits:t}),logo:f[r]||oe}}else{if(w.value)return{title:`PayPal ${j}`,logo:ae};if(c.value)return{title:`Shop Pay ending ${t}`,logo:le}}return{}}),{pm:y}=O,_=F(),I=d(()=>_.getters.authToken),P=d(()=>_.getters.urlParams),p=d(()=>(y==null?void 0:y.instrument)||{}),k=d(()=>!!p.value.customerCreditCard),w=d(()=>!!p.value.customerPaypalBillingAgreement),c=d(()=>!!p.value.customerShopPayAgreement),n=d(()=>p.value[Object.keys(p.value)[0]]||{});function l(){g.value=!g.value}function i(t=1){return["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t]}async function M(){var t;h.value=!0;try{const{id:r}=y||{};if(r)await q.sendUpdatePaymentmethodMail(r,I.value,(t=P.value)==null?void 0:t.customer_id),_.dispatch("showToast",{message:m("portal.payment_method.send_edit_mail.success"),showToast:!0,variant:"success"}),l();else throw m("portal.something_went_wrong")}catch(r){_.dispatch("showToast",{message:r,showToast:!0,variant:"alert"})}finally{h.value=!1}}return(t,r)=>(u(),v("div",{class:K(["pm-container",{"pm-select-container":e.isSelectable}]),onClick:r[0]||(r[0]=j=>e.isSelectable&&!e.disabled&&t.$emit("selectPayment",a(y)))},[e.isSelectable?(u(),v("div",ie,[s("input",{type:"radio",name:"selectPayment",value:a(y).id,id:a(b).title,checked:e.isSelected,disabled:e.disabled},null,8,re)])):C("",!0),s("div",de,[s("div",pe,[s("img",{class:"pm-logo",src:a(b).logo,alt:"Payment method"},null,8,ce),s("div",null,[s("div",ue,o(a(b).title),1),s("div",me,[a(n).expiryMonth&&a(n).expiryYear?(u(),v(x,{key:0},[s("span",he,[a(n).expired?(u(),v(x,{key:0},[S(o(t.$t("portal.payment_method.expired")),1)],64)):(u(),v(x,{key:1},[S(o(t.$t("portal.payment_method.valid_until")),1)],64))]),s("span",null,o(i(a(n).expiryMonth))+" "+o(a(n).expiryYear),1)],64)):a(n).inactive?(u(),v("span",ye,o(t.$t("shopify.subscriptions_page.details.payment_methods.inactice")),1)):C("",!0)])])]),e.isEditable?(u(),v("div",ve,[g.value?C("",!0):(u(),H(a(U),{key:0,class:"pm-edit-btn",variant:a(E).Link,onClick:l,"data-testid":"edit-method"},{default:L(()=>[S(o(t.$t("portal.common.edit")),1)]),_:1},8,["variant"]))])):C("",!0)]),g.value?(u(),v("div",fe,[s("div",ge,[s("ul",null,[s("li",null,o(t.$t("portal.payment_method.send_edit_mail.title1")),1),s("li",null,o(t.$t("portal.payment_method.send_edit_mail.title2")),1),s("li",null,[s("span",be,o(t.$t("portal.common.note"))+":",1),S(" "+o(t.$t("portal.payment_method.send_edit_mail.note")),1)])])]),s("div",_e,[B(a(U),{"data-testid":"primary-btn",variant:a(E).Primary,class:"pm-edit-primary-cta",onClick:M,loading:h.value},{default:L(()=>[S(o(t.$t("portal.payment_method.update_btn_label")),1)]),_:1},8,["variant","loading"]),B(a(U),{"data-testid":"sec-btn",variant:a(E).Link,disabled:h.value,onClick:l},{default:L(()=>[S(o(t.$t("portal.common.cancel")),1)]),_:1},8,["variant","disabled"])])])):C("",!0)],2))}});var Te=X(Pe,[["__scopeId","data-v-267660fa"]]);export{Te as M,Se as u};
